"use strict";(()=>{function k(g,t,e=[]){let s=0,i=0,n=0,o=100,u;do{u=!1,s=Math.random()*(window.innerWidth-g),i=Math.random()*(window.innerHeight-t);for(let r of e){let c=[Math.min(...r.targetPoints.map(a=>a[0])),Math.min(...r.targetPoints.map(a=>a[1])),Math.max(...r.targetPoints.map(a=>a[0])),Math.max(...r.targetPoints.map(a=>a[1]))];if(!(s+g<c[0]||s>c[2]||i+t<c[1]||i>c[3])){u=!0;break}}n++}while(u&&n<o);return[s,i]}function P(g){return g.map(t=>t.slice(0,2))}function M(g,t,e,s){return Math.hypot(e-g,s-t)}var H="0.0.1.3";function I(g){let t=document.createElement("div");t.id="controls",t.innerHTML=`
    <div style="display:flex; justify-content:space-between; align-items:center;">
  <strong>Controls</strong>
  <button id="closeHelp" style="background:#808080;color:white;border:none;padding:2px 6px;cursor:pointer;">X</button>
</div>
<pre style="margin-top:5px;">
SHIFT-Space: Toggle edit mode

In Edit Mode

click / drag:       select and move quads/corner points
SHIFT + drag:       move selected quad/corner point with 10x precision
ALT + drag:         rotate/scale selected quad
Arrow keys:         move selected quad/corner point
SHIFT + Arrow keys: move selected quad/corner point by 10 pixels
ALT + Arrow keys:   rotate/scale selected quad
's':                Solo/unsolo selected quad
'c':                Toggle mouse cursor crosshairs
'r':                Rotate selected layer 90 degrees clock-wise
'h':                Flip selected layer horizontally
'v':                Flip selected layer vertically
'b':                Show/Hide projector bounds
'l':                Show/Hide layer labels
'\u232B'/'Del':         Delete selected layer

MLMap | Version ${H}
</pre>
    `,Object.assign(t.style,{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",width:"600px",background:"#404040",color:"white",fontFamily:"monospace",padding:"10px",border:"2px solid #808080",zIndex:"1000001",cursor:"move",display:"none",userSelect:"none"}),document.body.appendChild(t),document.getElementById("closeHelp")?.addEventListener("click",()=>{t.style.display="none"});let e=document.createElement("div");e.id="shapePanel",Object.assign(e.style,{position:"fixed",top:"10px",right:"10px",width:"200px",background:"#303030",color:"white",fontFamily:"monospace",padding:"10px",border:"2px solid #808080",zIndex:"1000002",display:"none"}),e.innerHTML=`<strong>Shapes</strong><div id="shapeList"></div>
    <button id="addSquare">Add Square</button>
    <button id="addCircle">Add Circle</button>
    <button id="addTriangle">Add Triangle</button>`,document.body.appendChild(e);let s=!1,i=0,n=0;t.addEventListener("mousedown",function(d){d?.target?.id!=="closeHelp"&&(s=!0,i=d.clientX-t.offsetLeft,n=d.clientY-t.offsetTop)}),document.addEventListener("mousemove",function(d){s&&(t.style.left=d.clientX-i+"px",t.style.top=d.clientY-n+"px",t.style.transform="")}),document.addEventListener("mouseup",function(){s=!1});let o=document.getElementById("shapeList"),u=document.getElementById("addSquare"),r=document.getElementById("addCircle"),c=document.getElementById("addTriangle"),a=new WeakMap,h=[];function y(d){let l=document.createElement("div");l.id=`shape_${Date.now()}`;let[b,S]=k(100,100);l.style.position="fixed",l.style.top=S+"px",l.style.left=b+"px",l.style.width="100px",l.style.height="100px",l.style.background=d==="triangle"?"transparent":"white",l.style.border=d==="triangle"?"2px solid white":"none",d==="circle"&&(l.style.borderRadius="50%"),d==="triangle"&&(l.style.width="0",l.style.height="0",l.style.borderLeft="50px solid transparent",l.style.borderRight="50px solid transparent",l.style.borderBottom="100px solid white",g.addLayer(l,P([[50,0],[100,100],[0,100],[50,100]]))),document.body.appendChild(l),g.addLayer(l),h.push({id:l.id,type:d,x:b,y:S}),f(),m()}function f(){o.innerHTML="",h.forEach(d=>{let l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-between",l.style.marginBottom="4px",l.innerHTML=`${d.type} <button data-id="${d.id}">Delete</button>`,o.appendChild(l),l.querySelector("button")?.addEventListener("click",()=>L(d.id))})}function L(d){let l=h.findIndex(b=>b.id===d);if(l!==-1){let b=document.getElementById(d);b&&b.remove(),h.splice(l,1),f(),m()}}function m(){localStorage.setItem("mlmap.dynamicShapes",JSON.stringify(h))}function v(){let d=localStorage.getItem("mlmap.dynamicShapes");d&&(h=JSON.parse(d),h.forEach(l=>p(l)),f())}function p(d){let l=document.createElement("div");l.id=d.id;let b=d.x??Math.random()*(window.innerWidth-100),S=d.y??Math.random()*(window.innerHeight-100);l.style.position="fixed",l.style.top=S+"px",l.style.left=b+"px",l.style.width="100px",l.style.height="100px",l.style.background=d.type==="triangle"?"transparent":"white",l.style.border=d.type==="triangle"?"2px solid white":"none",d.type==="circle"&&(l.style.borderRadius="50%"),d.type==="triangle"&&(l.style.width="0",l.style.height="0",l.style.borderLeft="50px solid transparent",l.style.borderRight="50px solid transparent",l.style.borderBottom="100px solid white"),document.body.appendChild(l),g.addLayer(l)}u.addEventListener("click",()=>y("square")),r.addEventListener("click",()=>y("circle")),c.addEventListener("click",()=>y("triangle")),document.addEventListener("keydown",d=>{d.shiftKey&&d.code==="Space"&&(d.preventDefault(),t.style.display=t.style.display==="none"?"block":"none",e.style.display=e.style.display==="none"?"block":"none")});let w=g.setConfigEnabled;g.setConfigEnabled=function(d){w(d),e.style.display=d?"block":"none"},v(),new MutationObserver(d=>{for(let l of d)l.type==="childList"&&l.removedNodes.length>0&&l.removedNodes.forEach(b=>{if(b instanceof HTMLElement){let S=h.findIndex(D=>D.id===b.id);S!==-1&&(h.splice(S,1),f(),m())}})}).observe(document.body,{childList:!0,subtree:!0})}var B=(()=>{function g(r,c,a,h){if(a===c.length-1)return h(r);let y,f=c[a],L=Array(f);for(y=f-1;y>=0;--y)L[y]=g(r[y],c,a+1,h);return L}function t(r){let c=[];for(;typeof r=="object";)c.push(r.length),r=r[0];return c}function e(r){let c,a;return typeof r=="object"?(c=r[0],typeof c=="object"?(a=c[0],typeof a=="object"?t(r):[r.length,c.length]):[r.length]):[]}function s(r){let c,a=r.length,h=Array(a);for(c=a-1;c>=0;--c)h[c]=r[c];return h}function i(r){return typeof r!="object"?r:g(r,e(r),0,s)}function n(r,c){c=c||!1;let a,h,y,f,L,m,v,p,w,x=r.length,d=x-1,l=new Array(x);for(c||(r=i(r)),y=0;y<x;++y){for(v=y,m=r[y],w=u(m[y]),h=y+1;h<x;++h)f=u(r[h][y]),f>w&&(w=f,v=h);for(l[y]=v,v!=y&&(r[y]=r[v],r[v]=m,m=r[y]),L=m[y],a=y+1;a<x;++a)r[a][y]/=L;for(a=y+1;a<x;++a){for(p=r[a],h=y+1;h<d;++h)p[h]-=p[y]*m[h],++h,p[h]-=p[y]*m[h];h===d&&(p[h]-=p[y]*m[h])}}return{LU:r,P:l}}function o(r,c){let a,h,y,f,L,m=r.LU,v=m.length,p=i(c),w=r.P;for(a=v-1;a>=0;--a)p[a]=c[a];for(a=0;a<v;++a)for(y=w[a],w[a]!==a&&(L=p[a],p[a]=p[y],p[y]=L),f=m[a],h=0;h<a;++h)p[a]-=p[h]*f[h];for(a=v-1;a>=0;--a){for(f=m[a],h=a+1;h<v;++h)p[a]-=p[h]*f[h];p[a]/=f[a]}return p}let u=Math.abs;return function(r,c,a){return o(n(r,a),c)}})(),T=[],N=50,E=class{constructor(t={}){this.localStorageKey="mlmap.layers";this.layers=[];this.configActive=!1;this.dragging=!1;this.dragOffset=[0,0];this.selectedLayer=null;this.selectedPoint=null;this.selectionRadius=20;this.hoveringPoint=null;this.hoveringLayer=null;this.isLayerSoloed=!1;this.mousePosition=[0,0];this.mouseDelta=[0,0];this.mouseDownPoint=[0,0];this.keyDown=this.keyDown.bind(this),this.setConfigEnabled=this.setConfigEnabled.bind(this),this.showLayerNames=this.getProp(t,"labels",!0),this.showCrosshairs=this.getProp(t,"crosshairs",!1),this.showScreenBounds=this.getProp(t,"screenbounds",!1),this.autoSave=this.getProp(t,"autoSave",!0),this.autoLoad=this.getProp(t,"autoLoad",!0),this.layerList=this.getProp(t,"layers",[]),this.layoutChangeListener=this.getProp(t,"onchange",()=>{}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.initCanvas(),this.loadSettings();for(let s of this.layerList)(s instanceof HTMLElement||typeof s=="string")&&this.addLayer(s);this.autoLoad&&this.loadSettings(),this.pushHistory(),new MutationObserver(s=>{s.forEach(i=>{i.removedNodes.forEach(n=>{this.layers.forEach((o,u)=>{o.element===n&&(o.overlay&&o.overlay.remove(),this.layers.splice(u,1))})})})}).observe(document.body,{childList:!0,subtree:!0})}getProp(t,e,s){return t&&t.hasOwnProperty(e)&&t[e]!==null?t[e]:s}initCanvas(){this.canvas.style.display="none",this.canvas.style.position="fixed",this.canvas.style.top="0px",this.canvas.style.left="0px",this.canvas.style.zIndex="1000000",this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("mousemove",this.mouseMove.bind(this)),window.addEventListener("mouseup",this.mouseUp.bind(this)),window.addEventListener("mousedown",this.mouseDown.bind(this)),window.addEventListener("keydown",this.keyDown.bind(this)),this.resize()}pushHistory(){let t=this.getLayout();T.push(JSON.stringify(t)),T.length>N&&T.shift()}saveSettings(){let t={version:"1.0",layout:this.getLayout()};localStorage.setItem(this.localStorageKey,JSON.stringify(t))}loadSettings(){let t=localStorage.getItem(this.localStorageKey);if(t)try{let e=JSON.parse(t);e.version==="1.0"&&e.layout?this.setLayout(e.layout):console.warn("MLMap: localStorage version mismatch, skipping load.")}catch(e){console.error("MLMap: Failed to parse layout from localStorage.",e)}}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.draw()}pointInTriangle(t,e,s,i){let n=e[1]*i[0]-e[0]*i[1]+(i[1]-e[1])*t[0]+(e[0]-i[0])*t[1],o=e[0]*s[1]-e[1]*s[0]+(e[1]-s[1])*t[0]+(s[0]-e[0])*t[1];if(n<0!=o<0)return!1;let u=-s[1]*i[0]+e[1]*(i[0]-s[0])+e[0]*(s[1]-i[1])+s[0]*i[1];return u<0&&(n=-n,o=-o,u=-u),n>0&&o>0&&n+o<u}pointInLayer(t,e){let[s,i,n,o]=e.targetPoints;return this.pointInTriangle(t,s,i,n)||this.pointInTriangle(t,o,s,n)}updateTransform(){let t=["","-webkit-","-moz-","-ms-","-o-"],e="transform";for(let s of t){let i=s+"transform";if(i in document.body.style){e=i;break}}for(let s=0;s<this.layers.length;s++){let i=[],n=[];for(let c=0,a=this.layers[s].sourcePoints.length;c<a;++c){let h=this.layers[s].sourcePoints[c],y=this.layers[s].targetPoints[c];i.push([h[0],h[1],1,0,0,0,-h[0]*y[0],-h[1]*y[0]]),n.push(y[0]),i.push([0,0,0,h[0],h[1],1,-h[0]*y[1],-h[1]*y[1]]),n.push(y[1])}let o=B(i,n,!0),u=[o[0],o[3],0,o[6],o[1],o[4],0,o[7],0,0,1,0,o[2],o[5],0,1],r=this.layers[s].element.style;r.setProperty(e,`matrix3d(${u.join(",")})`),r.setProperty(`${e}-origin`,"0px 0px 0px")}}rotateLayer(t,e){for(var s=Math.sin(e),i=Math.cos(e),n=[0,0],o=0;o<t.targetPoints.length;o++)n[0]+=t.targetPoints[o][0],n[1]+=t.targetPoints[o][1];n[0]/=4,n[1]/=4;for(var o=0;o<t.targetPoints.length;o++){var u=t.targetPoints[o][0]-n[0],r=t.targetPoints[o][1]-n[1];t.targetPoints[o][0]=u*i-r*s+n[0],t.targetPoints[o][1]=u*s+r*i+n[1]}}scaleLayer(t,e){for(var s=[0,0],i=0;i<t.targetPoints.length;i++)s[0]+=t.targetPoints[i][0],s[1]+=t.targetPoints[i][1];s[0]/=4,s[1]/=4;for(var i=0;i<t.targetPoints.length;i++){var n=t.targetPoints[i][0]-s[0],o=t.targetPoints[i][1]-s[1];t.targetPoints[i][0]=n*e+s[0],t.targetPoints[i][1]=o*e+s[1]}}undo(){if(T.length>1){T.pop();var t=JSON.parse(T[T.length-1]);this.setLayout(t),this.draw(),this.autoSave&&this.saveSettings()}}swapLayerPoints(t,e,s){var i=t[e][0],n=t[e][1];t[e][0]=t[s][0],t[e][1]=t[s][1],t[s][0]=i,t[s][1]=n}addLayer(t,e){let s=null;if(typeof t=="string"){if(s=document.getElementById(t),!s)throw new Error("MLMap: No element found with id: "+t)}else if(t instanceof HTMLElement)s=t;else throw new Error("MLMap: Invalid target");for(let n=0;n<this.layers.length;n++)if(this.layers[n].element.id===s.id){e&&(this.layers[n].targetPoints=P(e));return}s.style.position="fixed",s.style.display="block",s.style.top="0px",s.style.left="0px",s.style.padding="0px",s.style.margin="0px";let i={visible:!0,element:s,width:s.clientWidth,height:s.clientHeight,sourcePoints:[[0,0],[s.clientWidth,0],[s.clientWidth,s.clientHeight],[0,s.clientHeight]],targetPoints:[]};if(e)i.targetPoints=P(e);else{let[n,o]=k(i.width,i.height,this.layers);i.targetPoints=[[n,o],[n+i.width,o],[n+i.width,o+i.height],[n,o+i.height]]}this.layers.push(i),this.updateTransform()}removeLayer(t){let e=typeof t=="string"?document.getElementById(t):t;if(e){for(let s=this.layers.length-1;s>=0;s--)this.layers[s].element===e&&(this.layers[s].overlay&&this.layers[s].overlay?.remove(),this.layers.splice(s,1));this.updateTransform()}}setLayout(t){for(var e=0;e<t.length;e++){for(var s=!1,i=0;i<this.layers.length;i++)this.layers[i].element.id==t[e].id&&(console.log("Setting points."),this.layers[i].targetPoints=P(t[e].targetPoints),this.layers[i].sourcePoints=P(t[e].sourcePoints),s=!0);if(s)console.log('Maptastic: Element "" + layout[i].id + "" is already mapped.');else{var n=document.getElementById(t[e].id);n?this.addLayer(n,t[e].targetPoints):console.log('Maptastic: Can"t find element: '+t[e].id)}}this.updateTransform(),this.draw()}getLayout(){for(var t=[],e=0;e<this.layers.length;e++)t.push({id:this.layers[e].element.id,targetPoints:P(this.layers[e].targetPoints),sourcePoints:P(this.layers[e].sourcePoints)});return t}setConfigEnabled(t){this.configActive=t,this.canvas.style.display=t?"block":"none",t?this.draw():(this.selectedPoint=null,this.selectedLayer=null,this.dragging=!1,this.showScreenBounds=!1)}draw(){if(this.configActive){this.context.strokeStyle="red",this.context.lineWidth=2,this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.layers.length;t++){let e=this.layers[t];if(e.visible){e.element.style.visibility="visible",this.context.beginPath(),e===this.hoveringLayer?this.context.strokeStyle="red":e===this.selectedLayer?this.context.strokeStyle="red":this.context.strokeStyle="white",this.context.moveTo(e.targetPoints[0][0],e.targetPoints[0][1]);for(let i=0;i<e.targetPoints.length;i++)this.context.lineTo(e.targetPoints[i][0],e.targetPoints[i][1]);this.context.lineTo(e.targetPoints[3][0],e.targetPoints[3][1]),this.context.closePath(),this.context.stroke();let s=[0,0];for(let i=0;i<e.targetPoints.length;i++)e.targetPoints[i]===this.hoveringPoint?this.context.strokeStyle="red":e.targetPoints[i]===this.selectedPoint?this.context.strokeStyle="red":this.context.strokeStyle="white",s[0]+=e.targetPoints[i][0],s[1]+=e.targetPoints[i][1],this.context.beginPath(),this.context.arc(e.targetPoints[i][0],e.targetPoints[i][1],this.selectionRadius/2,0,2*Math.PI,!1),this.context.stroke();if(s[0]/=4,s[1]/=4,this.showLayerNames){let i=e.element.id.toUpperCase();this.context.font="16px sans-serif",this.context.textAlign="center";let n=this.context.measureText(i),o=[n.width+8,32];this.context.fillStyle="white";let u=window.innerHeight*.01,r=s[0],c=s[1];(e.width<n.width+10||e.height<20)&&(c=s[1]-e.height/2-10-u,c-o[1]/2<u&&(c=s[1]+e.height/2+20+u)),this.context.fillRect(r-o[0]/2,c-o[1]/2,o[0],o[1]),this.context.fillStyle="black",this.context.font="14px sans-serif",this.context.fillText(i,r,c)}}else e.element.style.visibility="hidden"}if(this.showCrosshairs&&(this.context.strokeStyle="yellow",this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(this.mousePosition[0],0),this.context.lineTo(this.mousePosition[0],this.canvas.height),this.context.moveTo(0,this.mousePosition[1]),this.context.lineTo(this.canvas.width,this.mousePosition[1]),this.context.stroke()),this.showScreenBounds){this.context.fillStyle="black",this.context.lineWidth=4,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.strokeStyle="#909090",this.context.beginPath();let t=this.canvas.width/10,e=this.canvas.height/10;for(let i=0;i<10;i++)this.context.moveTo(i*t,0),this.context.lineTo(i*t,this.canvas.height),this.context.moveTo(0,i*e),this.context.lineTo(this.canvas.width,i*e);this.context.stroke(),this.context.strokeStyle="white",this.context.strokeRect(2,2,this.canvas.width-4,this.canvas.height-4);let s=Math.round(e*.6);this.context.font=`${s}px mono, sans-serif`,this.context.fillRect(t*2+2,e*3+2,this.canvas.width-t*4-4,this.canvas.height-e*6-4),this.context.fillStyle="white",this.context.font="20px sans-serif",this.context.fillText(`${this.canvas.width} x ${this.canvas.height}`,this.canvas.width/2,this.canvas.height/2+s*.75),this.context.fillText("display size",this.canvas.width/2,this.canvas.height/2-s*.75)}}}mouseMove(t){if(this.configActive){if(t.preventDefault(),this.mouseDelta[0]=t.clientX-this.mousePosition[0],this.mouseDelta[1]=t.clientY-this.mousePosition[1],this.mousePosition[0]=t.clientX,this.mousePosition[1]=t.clientY,this.dragging){let e=t.shiftKey?.1:1;if(this.selectedPoint)t.shiftKey?this.scaleLayer(this.selectedLayer,1+this.mouseDelta[0]*.01):(this.selectedPoint[0]+=this.mouseDelta[0]*e,this.selectedPoint[1]+=this.mouseDelta[1]*e);else if(this.selectedLayer)if(t.altKey&&this.rotateLayer(this.selectedLayer,this.mouseDelta[0]*(.01*e)),t.ctrlKey)this.scaleLayer(this.selectedLayer,this.mouseDelta[1]*(-.005*e)+1);else for(let s=0;s<this.selectedLayer.targetPoints.length;s++)this.selectedLayer.targetPoints[s][0]+=this.mouseDelta[0]*e,this.selectedLayer.targetPoints[s][1]+=this.mouseDelta[1]*e;this.updateTransform(),this.autoSave&&this.saveSettings(),this.draw(),this.layoutChangeListener();return}this.canvas.style.cursor="default",this.hoveringPoint=null,this.hoveringLayer=null;for(let e=this.layers.length-1;e>=0;e--){let s=this.layers[e];if(s.visible){for(let i=0;i<s.targetPoints.length;i++){let n=s.targetPoints[i];if(M(n[0],n[1],t.clientX,t.clientY)<this.selectionRadius){this.hoveringPoint=n,this.hoveringLayer=s,this.canvas.style.cursor="pointer";break}}if(this.hoveringPoint)break}}if(!this.hoveringPoint)for(let e=this.layers.length-1;e>=0;e--){let s=this.layers[e];if(s.visible&&this.pointInLayer(this.mousePosition,s)){this.hoveringLayer=s,this.canvas.style.cursor="pointer";break}}this.draw()}}mouseDown(t){if(this.configActive){this.mouseDownPoint=[t.clientX,t.clientY],this.selectedPoint=null,this.selectedLayer=null;for(let e=this.layers.length-1;e>=0;e--){let s=this.layers[e];if(s.visible){for(let i=0;i<s.targetPoints.length;i++){let n=s.targetPoints[i];if(M(n[0],n[1],t.clientX,t.clientY)<this.selectionRadius){this.selectedPoint=n,this.selectedLayer=s;break}}if(this.selectedLayer)break}}if(!this.selectedLayer)for(let e=this.layers.length-1;e>=0;e--){let s=this.layers[e];if(s.visible&&this.pointInLayer([t.clientX,t.clientY],s)){this.selectedLayer=s;break}}this.selectedLayer&&(this.dragging=!0,this.draw())}}mouseUp(t){this.configActive&&(this.dragging&&(this.pushHistory(),this.autoSave&&this.saveSettings()),this.dragging=!1,this.selectedPoint=null)}keyDown(t){if(!this.configActive)if(t.keyCode==32&&t.shiftKey){this.setConfigEnabled(!0);return}else return;var e=t.keyCode,s=t.shiftKey?10:1,i=!1,n=[0,0];switch(console.log(e),e){case 32:if(t.shiftKey){this.setConfigEnabled(!1);return}break;case 37:n[0]-=s;break;case 38:n[1]-=s;break;case 39:n[0]+=s;break;case 40:n[1]+=s;break;case 67:this.showCrosshairs=!this.showCrosshairs,i=!0;break;case 76:if(!this.configActive)return;this.showLayerNames=!this.showLayerNames,i=!0;break;case 83:if(this.isLayerSoloed){for(var o=0;o<this.layers.length;o++)this.layers[o].visible=!0;this.isLayerSoloed=!1,i=!0}else if(this.selectedLayer!=null){for(var o=0;o<this.layers.length;o++)this.layers[o].visible=!1;this.selectedLayer.visible=!0,i=!0,this.isLayerSoloed=!0}break;case 66:this.showScreenBounds=!this.showScreenBounds,this.draw();break;case 72:this.selectedLayer&&(this.swapLayerPoints(this.selectedLayer.sourcePoints,0,1),this.swapLayerPoints(this.selectedLayer.sourcePoints,3,2),this.updateTransform(),this.draw());break;case 86:this.selectedLayer&&(this.swapLayerPoints(this.selectedLayer.sourcePoints,0,3),this.swapLayerPoints(this.selectedLayer.sourcePoints,1,2),this.updateTransform(),this.draw());break;case 82:this.selectedLayer&&(this.rotateLayer(this.selectedLayer,Math.PI/2),this.updateTransform(),this.draw());break;case 90:t.ctrlKey&&this.undo();break;case 46:case 8:if(this.selectedLayer){this.selectedLayer.element.remove(),this.selectedLayer.overlay&&this.selectedLayer.overlay.remove();let u=this.layers.indexOf(this.selectedLayer);u>=0&&this.layers.splice(u,1),this.selectedLayer=null,i=!0,this.updateTransform(),this.draw()}break}if(!this.showScreenBounds){if(this.selectedPoint)this.selectedPoint[0]+=n[0],this.selectedPoint[1]+=n[1],i=!0;else if(this.selectedLayer){if(t.altKey==!0)this.rotateLayer(this.selectedLayer,n[0]*.01),this.scaleLayer(this.selectedLayer,n[1]*-.005+1);else for(var o=0;o<this.selectedLayer.targetPoints.length;o++)this.selectedLayer.targetPoints[o][0]+=n[0],this.selectedLayer.targetPoints[o][1]+=n[1];i=!0}}i&&(this.updateTransform(),this.draw(),this.autoSave&&this.saveSettings(),this.pushHistory(),this.layoutChangeListener())}},R=new E({layers:[]});I(R);window.MLMap=E;})();
